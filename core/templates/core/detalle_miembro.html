{% extends 'core/base.html' %}

{% block content %}
<input type="button" class="btn-prev" value="<" onClick="javascript:history.go(-1);">

<div class="miembro-perfil">
    <div class="perfil-encabezado">
        <h1 class="perfil-nombre">{{ miembro.nombre_completo }}</h1>
        <span class="perfil-estado {% if miembro.activo %}estado-activo{% else %}estado-inactivo{% endif %}">
            {% if miembro.activo %}Activo{% else %}Inactivo{% endif %}
        </span>
    </div>
    
    <div class="perfil-detalles">
        <div class="detalle-item">
            <strong>NÃºmero de Socio:</strong>
            <p>{{ miembro.numero_socio }}</p>
        </div>
        <div class="detalle-item">
            <strong>Email:</strong>
            <p>{{ miembro.email }}</p>
        </div>
        <div class="detalle-item">
            <strong>Fecha de Ingreso:</strong>
            <p>{{ miembro.fecha_ingreso }}</p>
        </div>
    </div>
    
    <a href="{% url 'editar_miembro' miembro.id %}" class="btn3">Editar Perfil</a>
</div>

<div class="seccion-cuotas">
    <div class="cuotas-registro">
        <h2 class="seccion-titulo">Nueva Cuota</h2>
        <form method="post" class="formulario-cuota">
            {% csrf_token %}
            <div class="campo-grupo">
                {{ form.as_p }}
            </div>
            <button type="submit" class="btn3 btn-sm">Registrar Pago</button>
        </form>
    </div>

    <div class="cuotas-historial">
        <h2 class="seccion-titulo">Historial de Pagos</h2>
        <div class="lista-cuotas">
            {% for cuota in cuotas %}
                <div class="cuota-item {% if cuota.pagado %}cuota-pagada{% else %}cuota-pendiente{% endif %}">
                    <span>{{ cuota.fecha_pago }}</span>
                    <span>{{ cuota.monto }}</span>
                    <span>{{ cuota.get_periodo_display }}</span>
                    <span>
                        {% if cuota.pagado %}
                            Pagado
                        {% else %}
                            <form action="{% url 'marcar_pagado' cuota.id %}" method="post" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn-success btn-sm">Marcar Pagado</button>
                            </form>
                        {% endif %}
                    </span>
                    <form action="{% url 'eliminar_cuota' cuota.id %}" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn-sm">Eliminar</button>
                    </form>
                </div>
            {% empty %}
                <div class="sin-cuotas">No hay registros de pagos.</div>
            {% endfor %}
        </div>
        {% if cuotas %}
            <form action="{% url 'eliminar_todas_cuotas' miembro.id %}" method="post" style="margin-top: 20px;">
                {% csrf_token %}
                <button type="submit" class="btn-nav">Eliminar todas las cuotas</button>
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}